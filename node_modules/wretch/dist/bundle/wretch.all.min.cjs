const e=Symbol();function r(e={}){var r;return null===(r=Object.entries(e).find((([e])=>e.toLowerCase()==="Content-Type".toLowerCase())))||void 0===r?void 0:r[1]}function t(e){return/^application\/.*json.*/.test(e)}const o=function(e,r,t=0){return Object.entries(r).reduce(((r,[n,s])=>{const i=e[n];return Array.isArray(i)&&Array.isArray(s)?r[n]=t?[...i,...s]:s:r[n]="object"==typeof i&&"object"==typeof s?o(i,s,t):s,r}),{...e})},n={options:{},errorType:"text",polyfills:{},polyfill(e,r=1,t=0,...o){const n=this.polyfills[e]||("undefined"!=typeof self?self[e]:null)||("undefined"!=typeof global?global[e]:null);if(r&&!n)throw new Error(e+" is not defined");return t&&n?new n(...o):n}};class s extends Error{}const i=r=>{const t=Object.create(null);r=r._addons.reduce(((e,o)=>o.beforeRequest&&o.beforeRequest(e,r._options,t)||e),r);const{_url:n,_options:i,_config:c,_catchers:l,_resolvers:a,_middlewares:u,_addons:h}=r,f=new Map(l),d=o(c.options,i);let p=n;const _=(e=>r=>e.reduceRight(((e,r)=>r(e)),r)||r)(u)(((e,r)=>(p=e,c.polyfill("fetch")(e,r))))(n,d),y=new Error,g=_.catch((e=>{throw{__wrap:e}})).then((e=>{if(!e.ok){const r=new s;if(r.cause=y,r.stack=r.stack+"\nCAUSE: "+y.stack,r.response=e,r.url=p,"opaque"===e.type)throw r;return e[c.errorType]().then((t=>{throw r.message=t,r[c.errorType]=t,r.status=e.status,r}))}return e})),m=t=>o=>(t?g.then((e=>e&&e[t]())).then((e=>o?o(e):e)):g.then((e=>o?o(e):e))).catch((t=>{const o=t.__wrap||t,n=o.status&&f.get(o.status)||f.get(o.name)||t.__wrap&&f.has(e)&&f.get(e);if(n)return n(o,r);throw o})),b={_wretchReq:r,_fetchReq:_,_sharedState:t,res:m(null),json:m("json"),blob:m("blob"),formData:m("formData"),arrayBuffer:m("arrayBuffer"),text:m("text"),error(e,r){return f.set(e,r),this},badRequest(e){return this.error(400,e)},unauthorized(e){return this.error(401,e)},forbidden(e){return this.error(403,e)},notFound(e){return this.error(404,e)},timeout(e){return this.error(408,e)},internalError(e){return this.error(500,e)},fetchError(r){return this.error(e,r)}},w=h.reduce(((e,r)=>({...e,...r.resolver})),b);return a.reduce(((e,t)=>t(e,r)),w)},c={_url:"",_options:{},_config:n,_catchers:new Map,_resolvers:[],_deferred:[],_middlewares:[],_addons:[],addon(e){return{...this,_addons:[...this._addons,e],...e.wretch}},errorType(e){return{...this,_config:{...this._config,errorType:e}}},polyfills(e,r=0){return{...this,_config:{...this._config,polyfills:r?e:o(this._config.polyfills,e)}}},url(e,r=0){if(r)return{...this,_url:e};const t=this._url.split("?");return{...this,_url:t.length>1?t[0]+e+"?"+t[1]:this._url+e}},options(e,r=0){return{...this,_options:r?e:o(this._options,e)}},headers(e){return{...this,_options:o(this._options,{headers:e||{}})}},accept(e){return this.headers({Accept:e})},content(e){return this.headers({"Content-Type":e})},auth(e){return this.headers({Authorization:e})},catcher(e,r){const t=new Map(this._catchers);return t.set(e,r),{...this,_catchers:t}},resolve(e,r=0){return{...this,_resolvers:r?[e]:[...this._resolvers,e]}},defer(e,r=0){return{...this,_deferred:r?[e]:[...this._deferred,e]}},middlewares(e,r=0){return{...this,_middlewares:r?e:[...this._middlewares,...e]}},fetch(e=this._options.method,o="",n=null){let s=this.url(o).options({method:e});const c=r(s._options.headers),l="object"==typeof n&&(!s._options.headers||!c||t(c));return s=n?l?s.json(n,c):s.body(n):s,i(s._deferred.reduce(((e,r)=>r(e,e._url,e._options)),s))},get(e=""){return this.fetch("GET",e)},delete(e=""){return this.fetch("DELETE",e)},put(e,r=""){return this.fetch("PUT",r,e)},post(e,r=""){return this.fetch("POST",r,e)},patch(e,r=""){return this.fetch("PATCH",r,e)},head(e=""){return this.fetch("HEAD",e)},opts(e=""){return this.fetch("OPTIONS",e)},body(e){return{...this,_options:{...this._options,body:e}}},json(e,o){const n=r(this._options.headers);return this.content(o||t(n)&&n||"application/json").body(JSON.stringify(e))}},l=()=>({beforeRequest(e,r,t){const o=e._config.polyfill("AbortController",0,1);!r.signal&&o&&(r.signal=o.signal);const n={ref:null,clear(){n.ref&&(clearTimeout(n.ref),n.ref=null)}};return t.abort={timeout:n,fetchController:o},e},wretch:{signal(e){return{...this,_options:{...this._options,signal:e.signal}}}},resolver:{setTimeout(e,r=this._sharedState.abort.fetchController){const{timeout:t}=this._sharedState.abort;return t.clear(),t.ref=setTimeout((()=>r.abort()),e),this},controller(){return[this._sharedState.abort.fetchController,this]},onAbort(e){return this.error("AbortError",e)}}});function a(e,r=0,t,o=t.polyfill("FormData",1,1),n=[]){return Object.entries(e).forEach((([e,s])=>{let i=n.reduce(((e,r)=>e?`${e}[${r}]`:r),null);if(i=i?`${i}[${e}]`:e,s instanceof Array)for(const e of s)o.append(i,e);else!r||"object"!=typeof s||r instanceof Array&&r.includes(e)?o.append(i,s):null!==s&&a(s,r,t,o,[...n,e])})),o}const u={wretch:{formData(e,r=0){return this.body(a(e,r,this._config))}}};function h(e,r){return encodeURIComponent(e)+"="+encodeURIComponent("object"==typeof r?JSON.stringify(r):""+r)}const f={wretch:{formUrl(e){return this.body("string"==typeof e?e:(r=e,Object.keys(r).map((e=>{const t=r[e];return t instanceof Array?t.map((r=>h(e,r))).join("&"):h(e,t)})).join("&"))).content("application/x-www-form-urlencoded");var r}}},d=()=>{const e=new Map;let r=null;const t=(t,o,n,s)=>{if(!t.getEntriesByName)return 0;const i=t.getEntriesByName(o);return i&&i.length>0?(n(i.reverse()[0]),s.clearMeasures&&s.clearMeasures(o),e.delete(o),e.size<1&&(r.disconnect(),s.clearResourceTimings&&s.clearResourceTimings()),1):0};return{resolver:{perfs(o){return this._fetchReq.then((n=>((o,n,s)=>{if(!o||!n)return;const i=s.polyfill("performance",0);((o,n)=>(!r&&o&&n&&(r=new n((r=>{e.forEach(((e,n)=>{t(r,n,e,o)}))})),o.clearResourceTimings&&o.clearResourceTimings()),r))(i,s.polyfill("PerformanceObserver",0))&&(t(i,o,n,i)||(e.size<1&&r.observe({entryTypes:["resource","measure"]}),e.set(o,n)))})(this._wretchReq._url,o,this._wretchReq._config))).catch((()=>{})),this}}}};function p(e){return void 0!==e?e:""}const _=(e,r,t,o)=>{let n;if("string"==typeof r)n=r;else{const e=o.polyfill("URLSearchParams",1,1);for(const t in r){const o=r[t];if(r[t]instanceof Array)for(const r of o)e.append(t,p(r));else e.append(t,p(o))}n=e.toString()}const s=e.split("?");return n?t||s.length<2?s[0]+"?"+n:e+"&"+n:t?s[0]:e},y={wretch:{query(e,r=0){return{...this,_url:_(this._url,e,r,this._config)}}}},g=()=>{function e(e){return r=>(t,o)=>{let n=0,s=0;return r(t,o).then((r=>{try{const t=r.headers.get("content-length");s=t?+t:null;const o=new TransformStream({transform(r,t){n+=r.length,s<n&&(s=n),e.progress&&e.progress(n,s),t.enqueue(r)}});return new Response(r.body.pipeThrough(o),r)}catch(e){return r}}))}}return{beforeRequest:(r,t,o)=>r.middlewares([e(o)]),resolver:{progress(e){return this._sharedState.progress=e,this}}}};function m(e="",r={}){return{...c,_url:e,_options:r}.addon(l()).addon(u).addon(f).addon(d()).addon(y).addon(g())}m.default=m,m.options=function(e,r=0){n.options=r?e:o(n.options,e)},m.errorType=function(e){n.errorType=e},m.polyfills=function(e,r=0){n.polyfills=r?e:o(n.polyfills,e)},m.WretchError=s,module.exports=m;
//# sourceMappingURL=wretch.all.min.cjs.map
